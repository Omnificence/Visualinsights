<!DOCTYPE html>
<html>
<head>
    <title>jQuery imgNotes - Interactive Base</title>
    <link href="assets/css/bootstrap.css" rel="stylesheet" />
    <link href="assets/css/imageNotes.css" rel="stylesheet" />
    <script type="text/javascript" src="assets/js/jquery.min.js"></script>
    <script type="text/javascript" src="assets/js/jquery-migrate-1.2.1.min.js"></script>
    <script type="text/javascript" src="assets/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="assets/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="assets/js/imageNote/jquery.fs.zoetrope.min.js"></script>
    <script type="text/javascript" src="assets/js/imageNote//toe.min.js"></script>
    <script type="text/javascript" src="assets/js/imageNote//jquery.mousewheel.min.js"></script>
    <script type="text/javascript" src="assets/js/imageNote//imgViewer.min.js"></script>
    <script type="text/javascript" src="assets/js/imageNote//printThis.js"></script>
    <script type="text/javascript" src="assets/js/imageNote//imgNotes.js"></script>

</head>
<body>

    <div id="imgdiv" style="text-align: center;
    position: relative;
    width: 80%; margin-left:100px; margin-top:200px;">
        <img id="image" src="assets/imgs/a.jpg" width="100%" style="display:none;" />
        <div class="imgTool">
            <table class="fullT">
                <tr>
                    <td>
                        <div class="switch" style="width:50px; margin:0 auto;">
                            <input id="cmn-toggle-4" onchange="onChangeAnnot(this)" class="cmn-toggle cmn-toggle-round-flat" type="checkbox">
                            <label for="cmn-toggle-4"></label>
                        </div>

                        <p>Comments</p>
                        <p>On/Off</p>
                    </td>
                    <td>
                        <img src="../image/fillscreen.png" />
                        <p>Full screen</p>
                    </td>
                    <td>
                        <img onclick="fitToScreen()" src="../image/fit_to_page.png" />
                        <p>Fit to Page</p>
                    </td>
                    <td></td>
                    <td onclick="addComment()">
                        <img src="../image/add_comment.png" />
                        <p>Add Comments</p>
                    </td>
                    <td>
                        <img src="../image/pan.png" />
                        <p>Pan</p>

                    </td>
                    <td></td>
                    <td></td>
                    <td>
                        <img src="../image/save.png" />
                        <p>Save</p>
                    </td>
                    <td>
                        <img src="../image/send_feedback.png" />
                        <p>Send Feedback </p>
                    </td>
                </tr>
            </table>
        </div>
        
        <!--<button onclick="addComment()">Comment</button>

        <button id="toggleEdit">Edit</button> <button id="clear">Clear</button> <button id="print">Print</button>-->
        
    </div>
   
    <div class="clearfix">

    </div>

    <div id=txt></div>
    <script type="text/javascript">

        function containsObject(obj, list) {
            var i;
            for (i = 0; i < list.length; i++) {
                if (list[i] === obj) {
                    return true;
                }
            }

            return false;
        }




        var $img = null;
        var elementArray = [{ x: "0.5", y: "0.5", note: "AFL Grand Final Trophy AFL Grand FinalAFL Grand FinalAFL Grand FinalAFL Grand FinalAFL Grand FinalAFL Grand FinalAFL Grand FinalAFL Grand FinalAFL Grand FinalAFL Grand FinalAFL Grand FinalAFL Grand FinalAFL Grand FinalAFL Grand FinalAFL Grand FinalAFL Grand FinalAFL Grand FinalAFL Grand FinalAFL Grand FinalAFL Grand Final", id: 1 },
                                        { x: "0.322", y: "0.269", note: "Brisbane Lions Flag", id: 2 },
                                        { x: "0.824", y: "0.593", note: "Fluffy microphone", id: 3 }];


        ; (function ($) {
            $(document).ready(function () {
                $img = $("#image").imgNotes({
                    onAdd: function () {
                        this.options.vAll = "bottom";
                        this.options.hAll = "middle";
                        elem = $(document.createElement('div'))
                               .css({ width: '27px', height: '40px', 'text-align': 'center', color: '#fff', 'font-weight': 'bold', 'font-size': '14px' })
                        .prepend("<img  src='msg.png' style='width:40px; height:40px; position:absolute; top:0px; left:0px;' />");
                        return elem;
                    }
                });

            });
        })(jQuery);

        function addComment() {
            $img.imgNotes("option", "isAdd", true);
        }


        function InitPop() {
            $('.ppOver').each(function () {
                $(this).popover({
                    html: true,
                    content: function () {
                        var el = "disabled";
                        if ($img.imgNotes("option", "isAdd")) {
                            el = "";
                        }
                        return "<div data-popid='#" + $(this).attr("id") + "' id='_" + $(this).attr("id") + "' class='popCont'><textarea " + el + ">" + $(this).find('.pCont').html() + "</textarea> </div><img src='../image/close.png' data-popid='#" + $(this).attr("id") + "' onclick='onClickClosePP(this)'  class='closePop' />" +
                            "<div class='poNameDiv'><img src='../image/profile_img.png' class='proImg' /> Jayasudhan</div><div> <img src='../image/delete.png' data-popid='#" + $(this).attr("id") + "' onclick='onClickDeletePP(this)' class='delImg' /> <img class='saveImg' onclick='onClickSavePP(this)' src='../image/tick.png' /><img class='editImg' onclick='onClickEditPP(this)' src='../image/edit.png' /></div> </div>";
                    },
                    trigger: 'disabled',
                    animation: true
                }).on('shown.bs.popover', function () {
                    var popup = $(this);
                    $(this).parent().find("div.popover .close").click(function () {
                        popup.click();
                    });
                });
            });
        }

        function onChangeAnnot(ele) {
            if ($(ele).is(":checked")) {
                Import();
            }
            else {

                $('.ppOver').popover("hide");
                $img.imgNotes('clear');
            }
        }



        function Import() {
            $img.imgNotes("import", elementArray);
            InitPop();

        }
        function onClickClosePP(ele) {
            var id = $(ele).attr("data-popid");
            $(id).popover('hide');
        }
        function onClickSavePP(ele) {
            $parent = $(ele).parent().parent();
            $parent.find("textarea").attr("disabled", "disabled");
            $parent.find(".editImg").show();
            $(ele).hide();
            $mainelem = $($parent.find(".popCont").attr("data-popid"));
            var ID = parseInt($mainelem.find(".nID").val());
            var cObj = { x: $mainelem.attr("data-relx"), y: $mainelem.attr("data-rely"), note: $parent.find("textarea").val().trim(), id: ID };

            if (ID == 0) {
                elementArray.push(cObj);
            }
            else {
                for (var index = 0; index < elementArray.length; index++) {
                    if (elementArray[index].id == cObj.id) {
                        elementArray[index].note = cObj.note;
                    }
                }

            }

            $img.imgNotes("import", [cObj]);
            InitPop();

        }

        function onClickEditPP(ele) {
            $parent = $(ele).parent().parent();
            $parent.find("textarea").removeAttr("disabled");
            $parent.find(".editImg").hide();
            $parent.find(".saveImg").show();
        }



        function onClickDeletePP(ele) {
            $parent = $(ele).parent().parent();
            $mainelem = $($parent.find(".popCont").attr("data-popid"));

            var cObj = { x: $mainelem.attr("data-relx"), y: $mainelem.attr("data-rely"), note: $parent.find("textarea").val().trim(), id: parseInt($mainelem.attr("data-id")) };



            for (var index = 0; index < elementArray.length; index++) {
                if (elementArray[index].id == cObj.id) {
                    elementArray.splice(index, 1);
                    break;
                }
            }
            $mainelem.popover('hide');
            $mainelem.remove();
            //$img.imgNotes("import", [elementArray]);

        }

        function fitToScreen()
        {
            $("#image").imgViewer("option", "zoom", 1);
        }

        function zoomIn() {
            var val = parseFloat($("#image").imgViewer("option", "zoom")) + 0.4;
            if (val < 1)
                val = 1;
            $("#image").imgViewer("option", "zoom", val);
        }

        function zoomOut() {
            var val = parseFloat($("#image").imgViewer("option", "zoom")) - 0.4;
            if (val < 1)
                val = 1;
            $("#image").imgViewer("option", "zoom", val);
        }

    </script>
</body>
</html>